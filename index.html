<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eswar V | Portfolio</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0f172a;
      }
      ::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #475569;
      }
      /* Animation Utilities */
      @keyframes pulse-slow {
        0%, 100% { opacity: 0.3; }
        50% { opacity: 0.15; }
      }
      .animate-pulse-slow {
        animation: pulse-slow 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
    </style>

    <!-- Import Map for Gemini API -->
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.run/@google/genai"
      }
    }
    </script>
</head>
<body class="bg-slate-950 text-slate-50 selection:bg-blue-500/30">

    <!-- Background Gradients -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-blue-600/20 rounded-full blur-3xl opacity-30 mix-blend-screen animate-pulse" style="animation-duration: 4s;"></div>
        <div class="absolute bottom-0 right-1/4 w-96 h-96 bg-emerald-600/10 rounded-full blur-3xl opacity-30 mix-blend-screen animate-pulse" style="animation-duration: 7s;"></div>
    </div>

    <!-- Navbar -->
    <nav class="sticky top-0 z-40 bg-slate-950/70 backdrop-blur-lg border-b border-white/5 shadow-sm">
        <div class="max-w-6xl mx-auto px-4 md:px-8 h-16 flex items-center justify-between">
          <div class="font-bold text-xl tracking-tight text-white flex items-center gap-2">
            <div class="w-2 h-2 rounded-full bg-blue-500"></div>
            Eswar<span class="text-slate-400 font-light">V</span>
          </div>
          <div class="flex gap-4">
            <a href="https://github.com" target="_blank" class="p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-full transition-all"><i data-lucide="github" class="w-5 h-5"></i></a>
            <a href="https://linkedin.com" target="_blank" class="p-2 text-slate-400 hover:text-blue-400 hover:bg-blue-500/10 rounded-full transition-all"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
          </div>
        </div>
    </nav>

    <main class="relative max-w-6xl mx-auto px-4 md:px-8 py-16 space-y-32">

        <!-- Hero Section -->
        <section class="flex flex-col-reverse lg:flex-row items-center gap-12 lg:gap-20">
            <div class="flex-1 space-y-8 text-center lg:text-left">
                <div class="space-y-4">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-500/10 text-blue-400 text-xs font-semibold uppercase tracking-wider border border-blue-500/20">
                        <span class="relative flex h-2 w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
                        </span>
                        Open to Opportunities
                    </div>
                    <h1 class="text-5xl lg:text-7xl font-bold text-white tracking-tight leading-tight">
                        Hello, I'm <br />
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-blue-200 to-emerald-400" id="hero-name">
                            Eswar V
                        </span>
                    </h1>
                    <p class="text-lg text-slate-400 max-w-xl mx-auto lg:mx-0 leading-relaxed" id="hero-summary">
                        Loading summary...
                    </p>
                </div>
                
                <div class="flex flex-wrap justify-center lg:justify-start gap-4">
                    <a id="contact-btn" href="#" class="px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-semibold shadow-lg shadow-blue-600/20 transition-all hover:scale-105 active:scale-95 flex items-center gap-2">
                        <i data-lucide="mail" class="w-5 h-5"></i>
                        Contact Me
                    </a>
                    <button class="px-8 py-4 bg-slate-900 hover:bg-slate-800 text-white rounded-xl font-semibold border border-slate-700 transition-all hover:border-slate-500 flex items-center gap-2 group">
                        <i data-lucide="download" class="w-5 h-5 group-hover:translate-y-0.5 transition-transform"></i>
                        Download CV
                    </button>
                </div>

                <div class="flex flex-col sm:flex-row items-center justify-center lg:justify-start gap-4 sm:gap-8 pt-4 text-sm font-medium text-slate-500" id="contact-details">
                    <!-- Contact details injected by JS -->
                </div>
            </div>
            
            <div class="relative group shrink-0">
                <div class="absolute -inset-4 bg-gradient-to-r from-blue-600 to-emerald-600 rounded-full blur-2xl opacity-30 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
                <div class="relative w-64 h-64 lg:w-80 lg:h-80 rounded-full overflow-hidden border-4 border-slate-800 shadow-2xl bg-slate-900">
                    <div class="w-full h-full bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center">
                        <span class="text-6xl font-bold text-slate-700 select-none">EV</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Skills Section -->
        <section>
            <div class="flex items-center gap-3 mb-12">
                <div class="p-3 bg-blue-500/10 rounded-xl text-blue-400"><i data-lucide="cpu" class="w-7 h-7"></i></div>
                <h2 class="text-3xl font-bold text-white">Technical Arsenal</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="skills-container">
                <!-- Skills injected by JS -->
            </div>
        </section>

        <!-- Projects Grid -->
        <section>
            <div class="flex items-center gap-3 mb-12">
                <div class="p-3 bg-blue-500/10 rounded-xl text-blue-400"><i data-lucide="terminal" class="w-7 h-7"></i></div>
                <h2 class="text-3xl font-bold text-white">Featured Projects</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="projects-container">
                <!-- Projects injected by JS -->
            </div>
        </section>

        <!-- Experience & Education -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-16 lg:gap-24">
            <!-- Education -->
            <div>
                <div class="flex items-center gap-3 mb-12">
                    <div class="p-3 bg-blue-500/10 rounded-xl text-blue-400"><i data-lucide="book-open" class="w-7 h-7"></i></div>
                    <h2 class="text-3xl font-bold text-white">Education</h2>
                </div>
                <div class="relative border-l border-slate-800 ml-4 space-y-12" id="education-container">
                    <!-- Education injected by JS -->
                </div>
            </div>

            <!-- Internships & Certifications -->
            <div class="space-y-16">
                <div>
                    <div class="flex items-center gap-3 mb-12">
                        <div class="p-3 bg-blue-500/10 rounded-xl text-blue-400"><i data-lucide="briefcase" class="w-7 h-7"></i></div>
                        <h2 class="text-3xl font-bold text-white">Experience</h2>
                    </div>
                    <div class="relative border-l border-slate-800 ml-4" id="internship-container">
                        <!-- Internships injected by JS -->
                    </div>
                </div>

                <div>
                    <div class="flex items-center gap-3 mb-8">
                        <div class="p-3 bg-blue-500/10 rounded-xl text-blue-400"><i data-lucide="award" class="w-7 h-7"></i></div>
                        <h2 class="text-3xl font-bold text-white">Certifications</h2>
                    </div>
                    <div class="space-y-4" id="certifications-container">
                        <!-- Certifications injected by JS -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Achievements -->
        <section class="relative overflow-hidden bg-gradient-to-br from-blue-900/10 to-slate-900 rounded-3xl p-8 md:p-12 border border-white/5">
            <div class="absolute top-0 right-0 w-64 h-64 bg-blue-600/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
            
            <h2 class="relative z-10 text-2xl md:text-3xl font-bold text-white mb-10 text-center">Leadership & Achievements</h2>
            <div class="relative z-10 grid grid-cols-1 md:grid-cols-2 gap-8" id="achievements-container">
                <!-- Achievements injected by JS -->
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-950 py-12 border-t border-white/5 mt-32">
        <div class="max-w-6xl mx-auto px-4 text-center space-y-4">
            <p class="text-slate-500">
                © <span id="year"></span> Eswar V. Built with innovation.
            </p>
            <div class="flex justify-center gap-6 text-sm text-slate-600">
                <span>HTML5</span>
                <span>Tailwind</span>
                <span>Gemini AI</span>
            </div>
        </div>
    </footer>

    <!-- Chat Widget -->
    <div class="fixed bottom-6 right-6 z-50 flex flex-col items-end font-sans">
        <!-- Chat Window -->
        <div id="chat-window" class="hidden mb-4 w-[350px] md:w-[400px] bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl flex flex-col overflow-hidden transition-all duration-300 ease-in-out origin-bottom-right">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-4 flex justify-between items-center">
                <div class="flex items-center gap-2 text-white">
                    <i data-lucide="bot" class="w-5 h-5"></i>
                    <span class="font-semibold">Portfolio Assistant</span>
                </div>
                <button id="close-chat" class="text-white/80 hover:text-white transition-colors">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Messages Area -->
            <div id="chat-messages" class="flex-1 h-[400px] overflow-y-auto p-4 space-y-4 bg-slate-900/50">
                <!-- Messages will appear here -->
                <div class="flex gap-3">
                     <div class="w-8 h-8 rounded-full flex items-center justify-center shrink-0 bg-emerald-600">
                        <i data-lucide="bot" class="w-3 h-3 text-white"></i>
                     </div>
                     <div class="max-w-[80%] p-3 rounded-2xl text-sm leading-relaxed bg-slate-700 text-slate-100 rounded-tl-none border border-slate-600">
                        Hi! I'm Eswar's AI assistant. Ask me anything about his projects, skills, or experience!
                     </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-3 bg-slate-800 border-t border-slate-700">
                <div class="flex gap-2 relative">
                    <input
                        type="text"
                        id="chat-input"
                        placeholder="Ask about my skills..."
                        class="w-full bg-slate-900 text-slate-100 placeholder-slate-500 rounded-xl py-3 pl-4 pr-12 focus:outline-none focus:ring-2 focus:ring-blue-500 border border-slate-700 text-sm"
                    />
                    <button
                        id="send-btn"
                        class="absolute right-2 top-1/2 -translate-y-1/2 p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                    >
                        <i data-lucide="send" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Toggle Button -->
        <button
            id="chat-toggle"
            class="group relative flex items-center justify-center w-14 h-14 bg-blue-600 hover:bg-blue-500 text-white rounded-full shadow-lg hover:shadow-blue-500/30 transition-all duration-300 transform hover:scale-110"
        >
            <i data-lucide="message-circle" class="w-6 h-6 transition-all" id="toggle-icon"></i>
            <span class="absolute right-full mr-4 bg-white text-slate-900 px-3 py-1 rounded-lg text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap shadow-lg pointer-events-none">
                Ask AI Assistant
            </span>
        </button>
    </div>

    <!-- MAIN SCRIPT -->
    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        // --- CONSTANTS & DATA (Matches Resume Perfectly) ---
        const RESUME_DATA = {
            name: "Eswar V",
            role: "Electrical & Electronics Engineer | Data Science Enthusiast",
            location: "Madurai, Tamilnadu",
            contact: {
                phone: "+91 9488304457",
                email: "eswarvmb25@gmail.com",
                linkedin: "LinkedIn",
                github: "Github"
            },
            summary: "My objective is to build my career in a well-reputed company where my potential can be explored and effectively utilized for the success of the organization as well as my personal growth. As a fresher, I am a self-motivated, target-oriented individual with a positive attitude, eager to learn and contribute. I am a good team player, a fast learner, and easily adaptable to new environments, capable of working both independently and as part of a team.",
            skills: [
                { category: "Programming Languages", skills: ["Python", "SQL"] },
                { category: "Tools & Technologies", skills: ["Power BI", "Machine Learning", "Arduino", "IoT", "Embedded Systems", "Raspberry Pi"] },
                { category: "Soft Skills", skills: ["Communication Skills", "Leadership Quality", "Teamwork", "Adaptability"] },
                { category: "Languages", skills: ["English", "Tamil"] }
            ],
            internships: [
                { company: "Volkswagen Cars Madurai", role: "Human Resources Management", location: "Madurai", duration: "1 week" }
            ],
            education: [
                { institution: "Sethu Institute of Technology, Virudhunagar", degree: "B.E. in Electrical and Electronics Engineering", duration: "Apr 2021 – May 2025", score: "CGPA: 8.1" },
                { institution: "St Joseph Matriculation Hr. Sec. School, Madurai", degree: "HSC", duration: "Jun 2020 – Apr 2021", score: "Percentage: 77.37%" },
                { institution: "St Joseph Matriculation Hr. Sec. School, Madurai", degree: "SSLC", duration: "Jun 2018 – May 2019", score: "Percentage: 69.4%" }
            ],
            projects: [
                { title: "Bus Identification using RFID for Blind People", techStack: ["Arduino", "RFID", "IoT", "Embedded Systems", "Speaker Module"], description: "Designed a system to assist visually impaired individuals in identifying buses using RFID technology. The system announces the bus route/ID through speakers. Showcased at the YI Club Innovation Contest 2024.", year: "2024" },
                { title: "IoT Based Water Monitoring System in Village", techStack: ["IoT", "Arduino", "Ultrasonic Sensor", "ESP8266 Wi-Fi"], description: "An UBA (Unnat Bharat Abhiyan) project implemented in Kallikudi village. The system monitors water tank levels remotely using ultrasonic sensors and transmits data via Wi-Fi for real-time tracking.", year: "Jan 2025" },
                { title: "Chat Bot", techStack: ["Python", "NLP"], description: "Developed a mini-guide to AI and algorithms. The bot uses Natural Language Processing to understand user queries and provide simple, educational answers about Artificial Intelligence." }
            ],
            certifications: [
                { title: "AI WITH DATA SCIENTIST", description: "3 months course in Data Science with practical projects" },
                { title: "CORIZO Internship", description: "Basic Python and Data Science training with internship experience" },
                { title: "INTERNET OF THINGS", description: "3 weeks course covering Arduino and Raspberry Pi" }
            ],
            achievements: [
                { title: "Vertical Chairperson of YI Club of SIT", description: "Awarded by: YI Club of Madurai" },
                { title: "Treasurer", description: "Electrical and Electronics Student Organisation and Research. Given by: EEE Department of SIT" }
            ]
        };

        const SYSTEM_INSTRUCTION = `
            You are an AI assistant for Eswar V's personal portfolio website.
            Your role is to answer questions about Eswar's professional background, skills, and projects based strictly on the following resume data.
            RESUME DATA: ${JSON.stringify(RESUME_DATA)}
            GUIDELINES:
            1. Be polite, professional, and concise.
            2. If asked about contact info, provide the email or phone number.
            3. If asked about skills, summarize his key technical strengths.
            4. Highlight his projects like the RFID system for the blind and Water Monitoring.
        `;

        // --- RENDER FUNCTIONS ---

        function renderHero() {
            document.getElementById('hero-name').textContent = RESUME_DATA.name;
            document.getElementById('hero-summary').textContent = RESUME_DATA.summary;
            document.getElementById('contact-btn').href = `mailto:${RESUME_DATA.contact.email}`;
            
            const contactHTML = `
                <div class="flex items-center gap-2 hover:text-blue-400 transition-colors cursor-pointer">
                    <i data-lucide="phone" class="w-4 h-4"></i> ${RESUME_DATA.contact.phone}
                </div>
                <div class="flex items-center gap-2 hover:text-blue-400 transition-colors cursor-pointer">
                    <i data-lucide="mail" class="w-4 h-4"></i> ${RESUME_DATA.contact.email}
                </div>
                <div class="flex items-center gap-2 hover:text-blue-400 transition-colors cursor-pointer">
                    <i data-lucide="map-pin" class="w-4 h-4"></i> ${RESUME_DATA.location}
                </div>
            `;
            document.getElementById('contact-details').innerHTML = contactHTML;
        }

        function renderSkills() {
            const container = document.getElementById('skills-container');
            container.innerHTML = RESUME_DATA.skills.map(category => `
                <div class="group bg-slate-900/40 backdrop-blur-sm p-8 rounded-3xl border border-white/5 hover:border-blue-500/30 transition-all duration-300 hover:shadow-2xl hover:shadow-blue-900/20">
                    <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-blue-500 group-hover:animate-pulse"></span>
                        ${category.category}
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        ${category.skills.map(skill => `
                            <span class="px-4 py-2 bg-slate-800/50 text-slate-300 text-sm font-medium rounded-lg border border-slate-700/50 hover:bg-blue-500/10 hover:text-blue-400 hover:border-blue-500/30 transition-all cursor-default">
                                ${skill}
                            </span>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderProjects() {
            const container = document.getElementById('projects-container');
            container.innerHTML = RESUME_DATA.projects.map(project => `
                <div class="group relative bg-slate-900/40 backdrop-blur-sm rounded-2xl p-6 border border-white/5 hover:border-blue-500/30 transition-all duration-500 hover:-translate-y-1 hover:shadow-2xl hover:shadow-blue-900/20 flex flex-col h-full">
                    <div class="absolute top-0 right-0 p-6 opacity-0 group-hover:opacity-100 transition-opacity">
                         <i data-lucide="arrow-up-right" class="w-5 h-5 text-blue-500"></i>
                    </div>
                    <div class="flex justify-between items-start mb-6">
                        <div class="p-3 bg-blue-500/10 rounded-xl text-blue-400 group-hover:bg-blue-500 group-hover:text-white transition-all duration-300">
                             <i data-lucide="terminal" class="w-6 h-6"></i>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold text-slate-100 mb-3 group-hover:text-blue-400 transition-colors">
                        ${project.title}
                    </h3>
                    <p class="text-slate-400 text-sm leading-relaxed mb-6 flex-grow">
                        ${project.description}
                    </p>
                    <div class="space-y-4 mt-auto">
                        <div class="flex flex-wrap gap-2">
                            ${project.techStack.map(tech => `
                                <span class="text-xs font-medium px-2.5 py-1 bg-slate-800 text-slate-300 rounded-md border border-slate-700/50">
                                    ${tech}
                                </span>
                            `).join('')}
                        </div>
                        ${project.year ? `
                            <div class="pt-4 border-t border-white/5 flex items-center gap-2 text-xs text-slate-500 font-medium uppercase tracking-wider">
                                <i data-lucide="calendar" class="w-3 h-3"></i>
                                <span>${project.year}</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function createTimelineItem(title, subtitle, duration, location, badge) {
            return `
                <div class="relative pl-12 group">
                    <div class="absolute -left-[5px] top-2 w-2.5 h-2.5 rounded-full bg-slate-600 ring-4 ring-slate-950 group-hover:bg-blue-500 group-hover:ring-blue-900/30 transition-all duration-300 z-10"></div>
                    <div class="flex flex-col gap-1">
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-2">
                            <h3 class="text-xl font-bold text-slate-100 group-hover:text-blue-400 transition-colors">${title}</h3>
                            <div class="flex items-center gap-2 text-xs font-semibold uppercase tracking-wider text-slate-500 bg-slate-900/50 px-3 py-1 rounded-full border border-slate-800">
                                <i data-lucide="calendar" class="w-3 h-3"></i>
                                <span>${duration}</span>
                            </div>
                        </div>
                        <div class="text-lg text-slate-300 font-medium">${subtitle}</div>
                        <div class="flex flex-wrap items-center gap-4 text-sm text-slate-500 mt-1 mb-2">
                            ${location ? `
                                <div class="flex items-center gap-1">
                                    <i data-lucide="map-pin" class="w-3 h-3"></i>
                                    <span>${location}</span>
                                </div>
                            ` : ''}
                            ${badge ? `
                                <span class="text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded text-xs font-bold">${badge}</span>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderEducation() {
            document.getElementById('education-container').innerHTML = RESUME_DATA.education.map(edu => 
                createTimelineItem(edu.institution, edu.degree, edu.duration, null, edu.score)
            ).join('');
        }

        function renderInternships() {
            document.getElementById('internship-container').innerHTML = RESUME_DATA.internships.map(job => 
                createTimelineItem(job.role, job.company, job.duration, job.location)
            ).join('');
        }

        function renderCertifications() {
            document.getElementById('certifications-container').innerHTML = RESUME_DATA.certifications.map(cert => `
                <div class="group bg-slate-900/50 hover:bg-slate-800/50 p-5 rounded-xl border border-white/5 hover:border-blue-500/30 transition-all flex items-start gap-4">
                    <div class="mt-1 w-8 h-8 rounded-lg bg-emerald-500/10 text-emerald-400 flex items-center justify-center shrink-0 border border-emerald-500/20">
                        <i data-lucide="award" class="w-4 h-4"></i>
                    </div>
                    <div>
                        <h4 class="text-slate-200 font-semibold group-hover:text-white transition-colors">${cert.title}</h4>
                        <p class="text-slate-500 text-sm mt-1 leading-relaxed">${cert.description}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderAchievements() {
            document.getElementById('achievements-container').innerHTML = RESUME_DATA.achievements.map(item => `
                <div class="flex items-start gap-4 bg-slate-950/50 p-6 rounded-2xl border border-white/5">
                    <div class="mt-1 w-2 h-2 rounded-full bg-emerald-400 shadow-[0_0_10px_rgba(52,211,153,0.5)] flex-shrink-0"></div>
                    <div>
                        <h4 class="text-lg font-bold text-slate-200">${item.title}</h4>
                        <p class="text-slate-400 text-sm mt-2 leading-relaxed">${item.description}</p>
                    </div>
                </div>
            `).join('');
        }

        function initApp() {
            renderHero();
            renderSkills();
            renderProjects();
            renderEducation();
            renderInternships();
            renderCertifications();
            renderAchievements();
            document.getElementById('year').textContent = new Date().getFullYear();
            
            // Initialize Lucide icons
            lucide.createIcons();
        }

        initApp();

        // --- CHAT WIDGET LOGIC ---

        const chatToggle = document.getElementById('chat-toggle');
        const chatWindow = document.getElementById('chat-window');
        const closeChat = document.getElementById('close-chat');
        const toggleIcon = document.getElementById('toggle-icon');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const messagesArea = document.getElementById('chat-messages');

        let isChatOpen = false;
        let chatSession = null;
        
        // IMPORTANT: For a static HTML file on GitHub Pages, you cannot hide the API Key securely on the server.
        // You must paste your key below. 
        // If you are using this locally or in a secure environment, you might use process.env.
        // For this demo, we check if the environment has it, otherwise we ask or use a placeholder.
        const ENV_API_KEY = typeof process !== 'undefined' && process.env ? process.env.API_KEY : null;
        let apiKey = ENV_API_KEY; 

        function toggleChat() {
            isChatOpen = !isChatOpen;
            if (isChatOpen) {
                chatWindow.classList.remove('hidden');
                toggleIcon.setAttribute('data-lucide', 'x');
                // Focus input
                setTimeout(() => chatInput.focus(), 100);
            } else {
                chatWindow.classList.add('hidden');
                toggleIcon.setAttribute('data-lucide', 'message-circle');
            }
            lucide.createIcons();
        }

        chatToggle.addEventListener('click', toggleChat);
        closeChat.addEventListener('click', toggleChat);

        function appendMessage(role, text, isError = false) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex gap-3 ${role === 'user' ? 'flex-row-reverse' : 'flex-row'}`;
            
            const iconBg = role === 'user' ? 'bg-blue-600' : 'bg-emerald-600';
            const iconName = role === 'user' ? 'user' : 'bot';
            
            const bubbleClass = role === 'user' 
                ? 'bg-blue-600 text-white rounded-tr-none' 
                : 'bg-slate-700 text-slate-100 rounded-tl-none border border-slate-600';
            
            const errorClass = isError ? 'bg-red-900/50 border-red-800' : '';

            msgDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${iconBg}">
                    <i data-lucide="${iconName}" class="w-3 h-3 text-white"></i>
                </div>
                <div class="max-w-[80%] p-3 rounded-2xl text-sm leading-relaxed ${bubbleClass} ${errorClass}">
                    ${text}
                </div>
            `;
            
            messagesArea.appendChild(msgDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
            lucide.createIcons();
        }

        function appendLoader() {
            const loaderDiv = document.createElement('div');
            loaderDiv.id = 'chat-loader';
            loaderDiv.className = 'flex gap-3';
            loaderDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-emerald-600 flex items-center justify-center shrink-0">
                    <i data-lucide="bot" class="w-3 h-3 text-white"></i>
                </div>
                <div class="bg-slate-700 border border-slate-600 p-3 rounded-2xl rounded-tl-none flex items-center gap-2">
                    <span class="text-slate-400 text-xs animate-pulse">Thinking...</span>
                </div>
            `;
            messagesArea.appendChild(loaderDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
            lucide.createIcons();
        }

        function removeLoader() {
            const loader = document.getElementById('chat-loader');
            if (loader) loader.remove();
        }

        async function getChatSession() {
            if (chatSession) return chatSession;

            // If no API Key found in env, prompt user (simple way for static sites)
            if (!apiKey) {
                apiKey = prompt("Please enter your Google Gemini API Key to use the chat feature:");
                if (!apiKey) return null;
            }

            try {
                const ai = new GoogleGenAI({ apiKey: apiKey });
                chatSession = ai.chats.create({
                    model: "gemini-2.5-flash",
                    config: {
                        systemInstruction: SYSTEM_INSTRUCTION,
                    },
                });
                return chatSession;
            } catch (error) {
                console.error("Init Error", error);
                return null;
            }
        }

        async function handleSend() {
            const text = chatInput.value.trim();
            if (!text) return;

            chatInput.value = '';
            appendMessage('user', text);
            appendLoader();

            try {
                const session = await getChatSession();
                if (!session) {
                    removeLoader();
                    appendMessage('model', "I need an API key to function. Please refresh and provide a valid Gemini API Key.", true);
                    return;
                }

                const response = await session.sendMessage({
                    message: text,
                });
                
                removeLoader();
                appendMessage('model', response.text);

            } catch (error) {
                removeLoader();
                console.error(error);
                appendMessage('model', "Sorry, I encountered an error connecting to the AI.", true);
            }
        }

        sendBtn.addEventListener('click', handleSend);
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') handleSend();
        });

    </script>
</body>
</html>